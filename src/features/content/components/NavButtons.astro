---
import IconLeft from "~icons/tabler/arrow-big-left-lines-filled"
import IconRight from "~icons/tabler/arrow-big-right-lines-filled"

interface Props {
	previous?: { slug: string; title: string }
	next?: { slug: string; title: string }
	hasEditor?: boolean
}

const { previous, next, hasEditor = true } = Astro.props
const isNextDisabled = !next || hasEditor

const btnBaseClass =
	"group flex h-14 items-center gap-2 rounded-md px-4 transition-all duration-200 hover:bg-dark-fg/40 aria-disabled:pointer-events-none aria-disabled:opacity-50"
const iconBaseClass = "block h-6 w-6 rounded-lg transition-all duration-200 transform group-hover:text-yellow"
---

<nav class="not-prose mt-auto flex min-w-[400px] w-full items-center justify-between pb-2" aria-label="NavegaciÃ³n de lecciones">
  <a
    href={previous ? `/${previous.slug}` : undefined}
    aria-label={previous ? `Anterior: ${previous.title}` : undefined}
    aria-disabled={!previous}
    class={btnBaseClass}
  >
    <span class:list={[iconBaseClass, "group-hover:-translate-x-1"]}>
      <IconLeft font-size={20} />
    </span>
    <div class="flex flex-col text-left">
      <span class:list={["text-md font-medium", previous ? "text-yellow" : "text-[#ccc]"]}>
        Anterior
      </span>
      <span class="text-xs text-[#ccc]">{previous?.title || "-"}</span>
    </div>
  </a>
  <a
    id="next-lesson-btn"
    href={next ? `/${next.slug}` : undefined}
    aria-label={next ? `Siguiente: ${next.title}` : undefined}
    aria-disabled={isNextDisabled}
    class={btnBaseClass}
  >
    <div class="flex flex-col text-right">
      <span class:list={["text-md font-medium", next ? "text-yellow" : "text-[#ccc]"]}>
        Siguiente
      </span>
      <span class="text-xs text-[#ccc]">{next?.title || "-"}</span>
    </div>
    <span class:list={[iconBaseClass, "group-hover:translate-x-1"]}>
      <IconRight font-size={20} />
    </span>
  </a>
</nav>

<script>
  import { db } from "~/lib/stores/editor-store"

  const initNextButton = async () => {
    const btn = document.getElementById("next-lesson-btn") as HTMLAnchorElement | null
    if (!btn || !btn.href || btn.ariaDisabled !== "true") return

    const slug = document.querySelector<HTMLElement>("[data-slug]")?.dataset.slug
    if (!slug) return

    const updateNextButton = async () => {
      const isCompleted = await db.isCompleted(slug)
      btn.ariaDisabled = String(!isCompleted)
    }

    await updateNextButton()

    window.addEventListener("lesson:completed", updateNextButton)
    window.addEventListener("editor:reset", updateNextButton)
  }

  document.addEventListener("astro:page-load", initNextButton)
</script>